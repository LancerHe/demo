(function(b){Array.prototype.indexOf=function(d,e){for(var c=(e||0);c<this.length;c++){if(this[c]==d){return c}}};var a=a||{};b.fn.czCombobox=function(d){var e="czCombobox";var c=b(this).data(e);if(typeof d=="string"&&d=="instance"){return c}var d=b.extend({},a.czCombobox.defaults,d||{});return b(this).each(function(){var f=new a.czCombobox(d);f.$element=b(this);f.init();b(this).data(e,f)})};a.czCombobox=function(c){this.NAME="czCombobox";this.VERSION="0.2";this.options=c;this.$element=null;this.$wrap=null;this.$box=null;this.$ul=null;this.$li=null;this.currentIndex=-1;this.keys=[];this.prevKey=false};a.czCombobox.defaults={className:"",listzIndex:999,animationSpeed:0,maxHeight:200,dropUp:false,hideSelected:false,initCallback:null,blurCallback:null,focusCallback:null,changeCallback:null,showListCallback:null,hideListCallback:null};a.czCombobox.prototype={init:function(){var c=this;this._create();this._initList();b(window).resize(function(){c._initList()});b(window).scroll(function(){c._initList()});this._selectIndex(true);this._bindEvent()},debug:function(c){if(typeof c=="undefined"){c=this}if(window.console&&window.console.log){window.console.log(c)}else{alert(c)}},_create:function(){var c=this;this.$wrap=b('<div class="czCombobox"></div>');this.$box=b('<div class="combobox_txt"></div>');this.$ul=b('<ul class="combobox_list"></ul>');if(this.options.className){this.$wrap.addClass(this.options.className)}this.$ul.css({overflow:"auto",zIndex:this.options.listzIndex});if(typeof this.$element.attr("tabindex")!="underfine"){this.$wrap.attr("tabindex",this.$element.attr("tabindex"));this.$element.removeAttr("tabindex")}else{this.$wrap.attr("tabindex",0)}this.$element.hide();this.$wrap.insertAfter(this.$element);this.$box.prependTo(this.$wrap);this.$ul.appendTo(this.$wrap);var e="";if(this.$element.children("optgroup").length==0){this.$element.children().each(function(f){e+=c._setOptionHTML(b(this),f)})}else{var d=-1;this.$element.children().each(function(f){++d;if(b(this)[0].tagName.toUpperCase()=="OPTION"){e+=c._setOptionHTML(b(this),d)}else{e+='<li class="optgroup">'+b(this).attr("label")+"<ul>";b(this).children().each(function(){e+=c._setOptionHTML(b(this),d)});e+="</ul></li>"}})}this.$ul.html(e);this.$li=this.$ul.find("li:not(.optgroup)");this.ulHeight=this.$ul.height(),this.wrapHeight=this.$wrap.height(),this.liCounts=this.$li.length},_initList:function(){var d=this.$wrap.offset().top;var c=jQuery(window).height();var e=jQuery(window).scrollTop();if(this.ulHeight>parseInt(this.options.maxHeight)){this.ulHeight=parseInt(this.options.maxHeight)}this.onTop=false;this.$ul.css({top:this.wrapHeight+"px",height:this.ulHeight});if(this.options.dropUp!=false){d=d-e;if(d+this.ulHeight>=c){this.onTop=true;this.$ul.css({top:"-"+this.ulHeight+"px",height:this.ulHeight})}}},_bindEvent:function(){var c=this;this.$li.bind({mouseenter:function(d){b(d.target).addClass("li_hover")},mouseleave:function(d){b(d.target).removeClass("li_hover")},click:function(d){c.currentIndex=c.$li.index(b(d.target));c._selectIndex();c.hideComboList();d.stopPropagation()}});this.$wrap.bind({click:function(){if(c.$ul.is(":visible")){c.hideComboList();return false}else{c.showComboList();c.$ul.scrollTop(c.liOffsetTop)}},focus:function(){c.$box.addClass("box_focus");c.keyPress();c._callback("focus")},blur:function(){c.$box.removeClass("box_focus");c.$wrap.unbind("keydown");c.hideComboList();c._callback("blur")}});this.$box.bind({mouseenter:function(d){c.$box.addClass("box_hover")},mouseleave:function(d){c.$box.removeClass("box_hover")}})},_setOptionHTML:function(f,e){var d=f.text();var c="<li>"+d+"</li>";this.keys.push(d.charAt(0).toLowerCase());if(f.attr("selected")==true){this.currentIndex=e;if(this.options.hideSelected!=false){c='<li style="display:none">'+d+"</li>"}}return c},_selectIndex:function(f){if(f==true){this.$ul.css("visibility","hidden")}var d=this.$wrap.offset().top,g=this.$li.eq(this.currentIndex).offset().top,c=this.$ul.scrollTop();if(this.onTop==true){this.liOffsetTop=(((g-d)-this.wrapHeight)+c)+parseInt(this.options.maxHeight)}else{this.liOffsetTop=((g-d)-this.wrapHeight)+c}this.$ul.scrollTop(this.liOffsetTop);if(this.options.hideSelected!=false){this.$li.show().eq(this.currentIndex).hide()}else{this.$li.removeClass("li_selected").eq(this.currentIndex).addClass("li_selected")}var e=this.$li.eq(this.currentIndex).text();if(f==true){this.$box.text(e);this.$ul.css("visibility","").hide();this.$wrap.css("position","static");this._callback("init");return false}if(this.$element[0].selectedIndex!=this.currentIndex){this.$element[0].selectedIndex=this.currentIndex;this.$box.text(e);this._callback("change")}},showComboList:function(){var c=this;this.$ul.slideDown(this.options.animationSpeed);if(this.$wrap.css("position")!="relative"){this.$wrap.css("position","relative")}this._callback("showList");b(document).bind("click",function(d){var e=d.target;if(e.className.indexOf("combobox")==-1){c.$wrap.unbind("keydown");c.hideComboList()}d.stopPropagation()})},hideComboList:function(){this.$ul.hide();if(this.$wrap.css("position")=="relative"){this.$wrap.css("position","static")}this._callback("hideList");b(document).unbind("click")},keyPress:function(){var c=this;this.$wrap.keydown(function(g){if(g==null){var f=event.keyCode}else{var f=g.which}switch(f){case 40:case 39:c.gotoNext();return false;break;case 38:case 37:c.gotoPrev();return false;break;case 33:case 36:c.gotoFirst();return false;break;case 34:case 35:c.gotoLast();return false;break;case 13:case 27:c.hideComboList();return false;break}keyPressed=String.fromCharCode(f).toLowerCase();var d=c.keys.indexOf(keyPressed);if(typeof d!="undefined"&&d!=-1){++c.currentIndex;c.currentIndex=c.keys.indexOf(keyPressed,c.currentIndex);if(c.currentIndex==-1||c.currentIndex==null||c.prevKey!=keyPressed){c.currentIndex=c.keys.indexOf(keyPressed)}c._selectIndex();c.prevKey=keyPressed;return false}})},gotoNext:function(){if(this.currentIndex<(this.liCounts-1)){++this.currentIndex;this._selectIndex()}},gotoPrev:function(){if(this.currentIndex>0){--this.currentIndex;this._selectIndex()}},gotoFirst:function(){this.currentIndex=0;this._selectIndex()},gotoLast:function(){this.currentIndex=this.liCounts-1;this._selectIndex()},getText:function(){return this.$li.eq(this.currentIndex).text()},getValue:function(){return this.$element.val()},setFocus:function(){this.$wrap.focus()},setOption:function(d){var c=this;this.$element.find("option").each(function(e){if(b(this).val()==d){c.currentIndex=e;c._selectIndex();return}})},_callback:function(c){if(typeof this.options[c+"Callback"]!="function"){return}this.options[c+"Callback"].call(this)}}})(jQuery);